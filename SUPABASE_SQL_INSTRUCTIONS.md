# üö® URGENT: Updated SQL Migration Instructions

## Issue Fixed

The original schema used UUID for user IDs, but Firebase Auth uses TEXT strings (like "gEdM2ef5vQe3ybgPaccCwH7TF7G2"). The schema has been updated to use TEXT for user IDs.

## Step-by-Step Instructions

### Option 1: If You Haven't Run the Migration Yet ‚úÖ EASIEST

1. Go to Supabase Dashboard: https://supabase.com/dashboard/project/dalqnrkpjzlcklhqsoum
2. Click **SQL Editor**
3. Click **New Query**
4. Copy the ENTIRE contents of `supabase/migrations/001_initial_schema.sql`
5. Paste and click **RUN**
6. Done! ‚úÖ

### Option 2: If You Already Ran the Old Migration üîÑ RESET REQUIRED

You need to drop the existing tables and recreate them:

#### Step 1: Clean Up Old Tables

1. Go to Supabase Dashboard SQL Editor
2. Copy the contents of `supabase/migrations/000_cleanup_and_reset.sql`
3. Paste and click **RUN**
4. This will delete all existing tables (‚ö†Ô∏è any test data will be lost)

#### Step 2: Create New Tables

1. In SQL Editor, click **New Query**
2. Copy the ENTIRE contents of `supabase/migrations/001_initial_schema.sql`
3. Paste and click **RUN**
4. Verify success - should see "Success. No rows returned"

#### Step 3: Verify Tables

1. Go to **Database** > **Tables**
2. Verify all 6 tables exist:

   - ‚úÖ users (id should be TEXT, not UUID)
   - ‚úÖ projects (user_id should be TEXT, not UUID)
   - ‚úÖ inquiries
   - ‚úÖ admin_settings
   - ‚úÖ testimonials
   - ‚úÖ inventory

3. Click on `users` table
4. Check the `id` column - it should show type: `text` (NOT `uuid`)

## What Changed?

### Before (WRONG):

```sql
CREATE TABLE public.users (
    id UUID PRIMARY KEY,  -- ‚ùå Firebase Auth IDs are not UUIDs
    ...
);

CREATE TABLE public.projects (
    user_id UUID REFERENCES public.users(id),  -- ‚ùå Wrong type
    ...
);
```

### After (CORRECT):

```sql
CREATE TABLE public.users (
    id TEXT PRIMARY KEY,  -- ‚úÖ Matches Firebase Auth UID format
    ...
);

CREATE TABLE public.projects (
    user_id TEXT REFERENCES public.users(id),  -- ‚úÖ Correct type
    ...
);
```

## After Running Migration

Test the application:

1. Start dev server: `npm run dev`
2. Navigate to homepage
3. Login with your account
4. Try creating a new project
5. Should work without UUID errors! ‚úÖ

## Troubleshooting

### Error: "relation 'users' already exists"

**Solution:** Run the cleanup script first (`000_cleanup_and_reset.sql`), then run the main migration.

### Error: "invalid input syntax for type uuid"

**Solution:** Make sure you ran the UPDATED `001_initial_schema.sql` file (the one with TEXT, not UUID).

### Error: "permission denied"

**Solution:** Make sure you're logged into Supabase Dashboard with the correct project.

## Important Notes

- ‚úÖ User IDs are now TEXT to match Firebase Auth
- ‚úÖ Project IDs remain UUID (auto-generated by Supabase)
- ‚úÖ All other table IDs are UUID
- ‚úÖ No code changes needed - TypeScript types already support this
- ‚úÖ RLS policies updated to work with TEXT user IDs

## Summary of Files

| File                                            | Purpose                                     |
| ----------------------------------------------- | ------------------------------------------- |
| `supabase/migrations/000_cleanup_and_reset.sql` | Drops all tables (use if you need to reset) |
| `supabase/migrations/001_initial_schema.sql`    | Creates all tables with correct types       |

## Next Steps After Migration

1. ‚úÖ Verify tables created successfully
2. ‚úÖ Test user signup/login
3. ‚úÖ Test project creation
4. ‚úÖ Set admin user metadata (if needed)
5. ‚úÖ Continue with remaining component migrations

---

**Last Updated:** November 11, 2025  
**Issue:** Fixed UUID vs TEXT mismatch for Firebase Auth integration  
**Status:** Ready to deploy ‚úÖ
